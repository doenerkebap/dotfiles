#!/bin/bash

FILE="$XDG_CACHE_HOME"/current_color

get_current_color()
{
    if [ ! -f "$FILE" ]; then
	echo none > "$FILE"
    fi
    cat "$FILE"
}

switch()
{
    to="$1"
    switch_vim "$to"
    switch_termite "$to"
    echo "$to" > "$FILE"
}

toggle()
{
    current_color="$(get_current_color)"
    case "$current_color" in
        dark)
            switch light ;;
        light)
            switch dark ;;
	*)
            switch light ;;
    esac
}

switch_termite()
{
    cat "$ZSH"/termite/termite.config/{base-config,color-config-"$1"} > "$ZSH"/termite/termite.config/config
    killall -USR1 termite
}

switch_vim()
{
    for instance in $(vim --serverlist); do
        vim --servername $instance --remote-send "<Esc>:set background=$1<CR>"
    done
}


toggle
